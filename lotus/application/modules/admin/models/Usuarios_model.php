<?phpclass Usuarios_model extends CI_Model {    public function __construct() {        $this->load->database();    }    function login($usuario, $clave) {        $this->db->select('ID_USUARIO, USUARIO, CLAVE');        $this->db->from('admin_usuario');        $this->db->where('ESTADO_HABILITACION', 1);        $this->db->where('USUARIO', $usuario);        $this->db->where('CLAVE', MD5($clave));        $this->db->limit(1);        $query = $this->db->get();                if ($query->num_rows() == 1)         {            return $query->result();        }         else         {            return false;        }    }        public function buscar_usuario($usuario, $idUsuario=NULL) {        if ($usuario === null) {            return null;        } else {            $this->db->select('admin_usuario.ID_USUARIO');            $this->db->from('admin_usuario');            $this->db->where('admin_usuario.USUARIO', $usuario);            if ($idUsuario) {                $this->db->where('admin_usuario.ID_USUARIO <>', $idUsuario);            }            $query = $this->db->get();            return $query->row_array();        }    }    public function verificarpassold($idUsuario){        $this->db->select('admin_usuario.CLAVE');        $this->db->from('admin_usuario');        $this->db->where('admin_usuario.ID_USUARIO', $idUsuario);        $query = $this->db->get();        return $query->row_array();    }    public function buscar_usuarios($data = array()) {        $arrayParametros = array();        $arrayParametros['USUARIO'] = $data['USUARIO'] != '' ? '%' . $data['USUARIO'] . '%' : NULL;        $arrayParametros['ESTADO_HABILITACION'] = $data['ESTADO_HABILITACION'] != '' ? '%' . $data['ESTADO_HABILITACION'] . '%' : NULL;        $this->db->select('*');        $this->db->from('admin_usuario');        if ($arrayParametros['USUARIO'] != NULL) {            $this->db->where('admin_usuario.USUARIO =', $arrayParametros['USUARIO']);        }        if ($arrayParametros['ESTADO'] != NULL) {            $this->db->where('admin_usuario.ESTADO =', $arrayParametros['ESTADO']);        }                $consulta = $this->db->get();        $resultado = $consulta->result_array();        return $resultado;    }    public function obtener_datos_usuario($idUsuario) {        $this->db->select('admin_usuario.*, ');        $this->db->from('admin_usuario');        $this->db->where('admin_usuario.ID_USUARIO', $idUsuario);        $query = $this->db->get();        return $query->row_array();    }         public function crearUsuario($data)     {        $this->db->insert('admin_usuario', $data);        return $this->db->insert_id();    }    public function actualizarUsuario($data, $idUsuario)     {        $this->db->where('admin_usuario.ID_USUARIO', $idUsuario);        $this->db->update('admin_usuario', $data);    }    public function updateClave($idUsuario,$pass)     {        $data=array('CLAVE'=> md5($pass));        $this->db->where('admin_usuarios.ID_USUARIO', $idUsuario);        $this->db->update('admin_usuarios',$data);    }        public function generarClave()     {        //sha1 me da el hash de la cadena, es una codificacion          //uniqid genera un id unico        //mt_ran genera un numero aleatorio(numero inicial, numero final) incluye los extremos        $clave=sha1(uniqid(mt_rand(), true));         return $clave;    }        public function crearActualizarUsuario($idUsuario,$data)     {        if($idUsuario == NULL)        {            //$clave = $this->generarClave();            $time = time();            //$clave = "Lendan.2016";            $clave=$data['CLAVE'];            $data['ESTADO'] = 1;            $data['CLAVE'] = md5($clave);            $data['FECHA_CREACION']= date("d-m-Y", $time);            $idUsuario = $this->crearUsuario($data);                        $data['CLAVE_SIN_CIFRAR'] = $clave;            $data['ID_USUARIO'] = $idUsuario;        }        else        {            $this->actualizarUsuario($data, $idUsuario);        }        return $data;            }}